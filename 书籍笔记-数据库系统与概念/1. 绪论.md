# 1. 引言
## 1.1. 数据库系统的应用
## 1.2. 数据库系统的目标
传统文件处理系统弊病如下：（以大学内学生信息数据库为例）
- 数据的冗余与不一致（redundancy and inconsistency）
  - 不同的程序采用不同的程序设计语言写成
  - 相同的信息可能在几个地方重复存储（冗余与不一致）
  - 例：学生的地址信息在数学系和音乐系分别有备份
- 数据访问困难（difficulty in accessing data）
  - 需要**手工从总列表中提取信息**或者**针对该要求编写特定程序**
  - 例：找出住在特定地区的学生名单
- 数据孤立（data isolation）
  - 不同文件中的数据具有不同格式，检索困难
- 完整性问题(integrity problem)
  - 添加不同文件中的多个数据项的约束
  - 例：为每个系维护一个账户，记录各个账户的余额，多个约束要求
- 原子性问题(atomicity problem)
  - 如**借**与**贷**操作必须同时发生或者都不发生
  - 例：A系账户余额500元转到B系账户余额，A转出后系统故障，B可能还没存入，导致数据库状态不一致，要求原子性。
- 并发访问异常(concurrent-access anomaly)
  - 需要系统允许多个用户同时更新数据
  - 例：A系的账户（余额1000）由两个职员同时取出500元与400元，剩下的是500元还是600元还是100元。
- 安全性问题(security problem)
  - 并非所有用户都能访问所有数据
## 1.3. 数据视图
- 数据抽象
  - 物理层（physical level）
    - 最低层次的抽象；
    - 描述数据实际上怎样存储；
  - 逻辑层（logical level）
    - 比物理层稍高的抽象；
    - 数据库中存储什么数据，以及数据间存在什么关系；
  - 视图层（view level）
    - 最高层次的抽象，面向与用户交互；
    - 描述数据库的某个部分；
- 实例与模式  
  - 实例instance
    - 对应：程序设计语言中的变量在某一时刻的**值**
    - 定义：特定时刻存储在数据库中的信息的集合
  - 模式schema
    - 对应：程序设计语言中的变量**声明**
    - 定义：数据库的总体设计
    - 物理模式、逻辑模式、子模式（对应不同层次的抽象设计）
- 数据模型
  - 关系模型（relational model）
    - 定义：用表的集合来表示数据和数据间的联系
  - 实体-联系模型（entity-relationship model，E-R model）
    - 定义：基于可被称为实体的基本对象以及这些对象间的联系构成
  - 基于对象的数据模型（object-based data model）
    - 定义：可视作E-R模型增加了封装、方法（函数）和对象标识等概念后的扩展
  - 半结构化数据模型（semistructured data model）
    - 允许**相同类型的数据项**含有**不同的属性集**的数据定义

## 1.4. 数据库语言
> 数据库使用
> **数据定义语言**来**定义数据库模式**，  
> **数据操纵语言**来**表达数据库的查询与更新**
  - 数据操纵语言（data-manipulation language，DML）
    - 定义：使得用户可以访问或操作那些按照某种适当的数据类型组织起来的数据（访问类型：增改删查）
    - 种类:
      - 过程化DML(procedural DML)：要求用户指定需要什么数据以及如果获得
      - 声明式DML(declarative DML)：用户指定需要什么数据，不指定如何获得
    - 查询（query）是要求对数据进行检索的语句。实践中常把**查询语言**和**数据操纵语言**作为同义词使用
  - 数据定义语言(data-definition language，DDL)
    - 定义：通过一系列定义来说明数据库模式
    - 数据库系统实现可以以最小代价测试的完整性约束：
      - 域约束domain constraint
        - 每个属性必须对应于一个所有可能的取值构成的域
      - 参照完整性referential integrity
        - 一个关系中给定属性集上的取值也在另一关系的某一属性集的取值中出现（拥有其对应的映射）
        - 例：每门课程列出的系必须是实际存在的
      - 断言assertion
        - 数据库需要时刻满足的某一条件
        - 如果断言有效， 只有不破坏断言的数据库更新才被允许
        - 域约束与参照完整性是断言的一种特殊形式
      - 授权authorization
        - 读，只读不修改
        - 插入，只插入不修改
        - 更新，允许修改不删除
        - 删除，只删除

## 1.5. 关系数据库
- 表
  - Instructor表示意
    | ID  | name  | dept_name | salary |
    | --- | ----- | --------- | ------ |
    | 123 | Wu    | Physics   | 2000   |
    | 452 | Jiang | History   | 1238   |
- 数据操纵语言DML
  - SQL查询语言如 select，from，where
    ```
    select instructor.name 
    from instructor 
    where instructor.dept_name = 'History';
    ```
- 数据定义语言DDL
  - SQL定义语言
    ```
    create table department
    (department  char(20),
     building    char(15),
     budget      numeric(12,2));
    ```
- SQL语句的宿主语言
    - SQL语句无法实现如简单计算，输入输出或者网络通信的功能，需要如c,c++,java等宿主语言，在其中使用嵌入式的sql查询来访问。
    - 实现方式
      - 通过应用程序接口，如C语言的（ODBC）或者Java的（JDBC）标准
      - 通过扩展宿主语言的语法，在宿主语言中嵌入DML调用，通过预编译器来将其转变成过程调用
## 1.6. 数据库设计
- 设计过程（自上而下的一个过程）
  1. 预研：全面刻画预期的数据库用户的数据需求，制定出用户需求的规格文档
  2. 概念设计：选择一个数据模型并运用该数据模型的概念，将需求转换成数据库的概念模式
  3. 逻辑设计：将高层的概念模式映射到要使用的数据库系统的实现数据模型上
  4. 物理设计：将得到的特定于系统的数据库模式用到物理设计阶段
- 大学机构的数据库设计（上述的预研过程）
    - 大学分为多个系，每个系（dept_name）包含building和budget
    - 每个系有开设课程列表，每门课有course_id，title，dept_name，credits和prerequisites
    - 教师有ID，name，dept_name,salary
    - 学生有ID，name,dept_name,tot_cred
    - 大学有一个教室列表，包括building，room_number,capacity
    - 大学有一个课程开课的列表，每次开课有course_id,sec_id,year,semester,与之相关联的有semester,year,building,room_number,time_slot_id
    - 每个系有一个教学任务列表，说明每位教师的授课情况
    - 大学有一个所有学生课程注册的列表，说明学生的注册情况
- 实体-联系模型（E-R模型）
  - E-R模型使用一组称为**实体**（entity）的基本对象，以及这些对象间的联系
  - 数据库中实体通过**属性**(attribute)集合来描述，如department实体集的属性dept_name,building,budget等
  - **联系**（relationship）是几个实体之间的关联
  - 总体逻辑结构可用**实体-联系图**（entity-relationship，E-R图）进行图形化表示，最常用的方法是采用统一建模语言（Unified-Modeling Language，UML）
    - 实体集用矩形框表示，实体名在头部，属性名在下部
    - 联系集用连接一对实体集的菱形框表示，联系名放于内部
- 规范化
  - 目标：生成一个关系模式集合，使得存储信息时没有不必要的冗余，同时又能很轻易地检索数据

## 1.7. 数据存储与查询
> 数据库系统的功能部件大致可分为**存储管理器**和**查询处理部件**
- 存储管理器
  - 定义：数据库系统中负责在  数据库中存储的底层数据，应用程序，向系统提交的查询  之间提供接口的部件。
  - 存储管理器负责将各种DML语句翻译为底层文件系统命令。
  - 存储管理部件：
    - **权限及完整性管理器**：检测是否满足完整性约束，检查试图访问数据的用户权限
    - **事务管理器**：保证即使发生了故障，数据库也保持在一致的状态，保证并发事务的执行不发生冲突
    - **文件管理器**：管理磁盘存储空间的分配，管理用于表示磁盘上所存储信息的数据结构
    - **缓冲区管理器**：负责将数据从磁盘中去到内存中来，并决定哪些数据应被缓冲存储在内存中
  - 存储管理器实现的数据结构：
    - **数据文件**：存储数据库本身
    - **数据字典**：存储关于数据库结构的元数据，尤其是数据库模式
    - **索引**：提供对数据项的快速访问
- 查询处理器
  查询处理组件包括
  - DDL解释器：他解释DDL语句并将这些定义记录在数据字典中
  - DML编译器：将查询语言中的DML语句翻译为一个执行方案
  - 查询执行引擎：执行由DML编译器产生的低级指令
## 1.8. 事务管理 
- 数据库执行操作时的三个特性：
  - 原子性atomicity：操作要么**完成**要么**不发生**
  - 一致性consistency：正确性的要求，保持一致
  - 持久性durability：保持的要求
- **事务**（transaction）是数据库应用中完成单一逻辑功能的**操作集合**，既具有**原子性**，也具有**一致性**（事务启动时与成功结束时是一致的，中间允许暂时的不一致）。
- **事务管理器**（transaction manager）包括**恢复管理器**和**并发控制管理器**：
  - 恢复管理器（recovery manager）保证**原子性**（失败的事务不对状态产生影响，即数据库要被恢复到该失败事务开始执行以前的状态）和**持久性**。
  - 并发控制管理器（concurrency-control manager）控制并发事务间的相互影响（避免事务的并发影响一致性）。
## 1.9. 数据库体系结构
![1-1数据库系统体系结构](/assets/1-1数据库系统体系结构.png)
## 1.10. 数据挖掘与信息探索
数据挖掘（data mining）指半自动地分析大型数据库并从中找到有用模式的过程。不同于机器学习和统计分析，它处理大量的存储在磁盘上（即数据库中）的数据。
## 1.11. 特种数据库
- 基于对象的数据模型
- 半结构化数据模型
## 1.12. 数据库用户与管理员
> 使用数据库的人员可分为用户和管理员
- 数据库用户
  - 无经验的用户naive user：学生选课，职员添加信息等
  - 应用程序员application programmer：编写应用程序的计算机专业人员
  - 老练的用户sophisticated user：使用数据库查询语言或数据分析软件
  - 专门的用户specialized user：编写专门的、不适合于传统数据处理框架的数据库应用的富有经验的用户
- 数据库管理员（database administrator，DBA）
  - 定义：对系统进行集中控制的人
  - 作用
    - 模式定义
    - 存储结构及存取方法定义
    - 模式及物理组织的修改
    - 数据访问授权
    - 日常维护：定期备份数据库、确保正常运转时所需的空余磁盘空间、监视数据库的运行
## 1.13. 数据库系统的历史


