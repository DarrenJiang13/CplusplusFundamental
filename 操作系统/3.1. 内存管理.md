# 3.1. 内存管理

## 3.1.1 内存基础知识
### **知识总览**
- 什么是内存，有何作用
    - 存储单元
    - 内存地址
- 进程运行基本原理
    - 指令的工作原理
    - 逻辑地址 vs 物理地址
    - 从写程序到程序运行：编辑——编译——链接——装入
    - 三种链接方式
    - 三种装入方式

### **什么是内存**
> 内存是用于存放数据的硬件。程序执行前需要先放到内存中才能被CPU处理

- 存储单元： 内存中有一个一个的“小房间”，每个小房间就是一个存储单元
- 内存地址： 内存地址从0开始，每个地址对应一个存储单元

### **进程运行原理——指令**
> 我们写的代码要翻译成CPU能识别的指令，这些指令会告诉CPU应该去内存的哪个地方读取数据

### **物理地址VS逻辑地址**
- 物理地址： 绝对地址
- 逻辑地址： 相对地址

### **写程序到程序运行**
- **编译**  
    由编译程序把用户源代码(.c文件)编译成若干个目标模块（编译：高级语言翻译为机器语言）  
- **链接**  
    由链接程序将编译后形成的一组目标模块(.o文件)，以及所需库函数链接在一起，形成一个完整的装入模块(.exe文件)
- **装入**  
    由装入程序将装入模块装入内存运行。  
    装入模块中的指令地址指的是“相对地址”，即：相对于开始地址而言的地址，又称“逻辑地址”。（如：指令1：往地址为80的存储单元中写入1）

### **链接的三种方式**
- 静态链接  
    在程序运行之前，先将各目标模块以及他们所需的库函数连接成一个完整的可执行文件（装入模块），之后不再拆开。
- 装入时动态链接：  
    将各目标模块装入内存时，边装入边链接
- 运行时动态链接
    在程序执行中需要改目标模块时，才对他进行链接。优点是便于修改和更新，便于实现对目标模块的共享。

### **装入的三种方式**
- 绝对装入  
    > 在编译时，如果知道程序将放到内存中的哪个位置，编译程序将产生绝对地址的目标代码，装入程序将按照装入模块中的地址，将程序和数据装入内存。
    ```c++
    // 如果知道装入模块要从地址为100的地方开始放
    指令1：往地址为80的存储单元中写入1
    编译链接后得到
    指令1：往地址为180的存储单元中写入1
    ```
    此方法灵活性很低，只适用于单道程序环境

- 静态重定位
    > 又称 可重定位装入。编译、链接后的装入模块的地址都是从零开始的，指令中使用的地址、数据存放的地址，都是相对于起始地址开始的逻辑地址。可根据内存的当前情况，将装入模块装入到内存的适当位置。装入时对地址进行“重定位”，将逻辑地址变换为物理地址。

    - 一个作业装入内存时，必须分配其要求的全部内储存空间，如果没有足够的内存，就不能装入该作业。
    - 作业一旦进入内存后，在运行期间就不能再移动，也不能再申请内存空间。
    - 与绝对装入区别：装入模块中静态重定位储存的依然是逻辑地址，而绝对装入中装入模块储存的是物理地址。

- 动态重定位
    > 又称 动态运行时装入。编译、链接后的装入模块的地址都是从零开始的，装入程序把装入模块装入到内存后，并不会立即把逻辑地址转换为物理地址，而是把地址转换推迟到程序真正要执行时才进行。因此装入内存后所有的地址依然是逻辑地址。 这种方式需要一个重定位寄存器的支持。
    - 允许程序在内存中发生移动

### **知识回顾**
- 什么是内存，有何作用
    - 存储单元与内存地址
    - 内存地址：按字节编址和按字编址
- 进程运行基本原理
    - 指令的工作原理：操作码+若干参数
    - 逻辑地址 vs 物理地址：相对VS绝对
    - 从写程序到程序运行
        - 编辑源代码文件
        - 编译：源代码生成目标模块
        - 链接：由目标模块生成装入模块，连接后形成完整的逻辑地址
        - 装入：装入模块装入内存，装入后形成物理地址
    - 三种链接方式
        - 静态链接：装入前连接成一个完整装入模块
        - 装入时动态链接：运行前边装入边链接
        - 运行时动态链接：运行时需要目标模块才装入并链接
    - 三种装入方式
        - 绝对装入： 编译时产生绝对地址
        - 可重定位装入： 装入时将逻辑地址转换为物理地址
        - 动态运行时装入： 运行时将逻辑地址转换为物理地址，需设置重定位寄存器

## 3.1.2 内存管理的概念
### **知识总览**
- 内存空间的分配与回收
- 内存空间的扩充
- 地址转换
- 内存保护

### **内存空间的分配与回收**
见之后章节
### **内存空间的扩充**
见之后章节
### **地址转换**
见3.1.1
### **内存保护**
1. 方法一：CPU中设置上限寄存器，下限寄存器，存放进程的上、下限地址。进程的指令要访问某个地址时，CPU检查是否越界
2. 方法二：采用重定位寄存器和界地址寄存器进行越界检查，重定位寄存器存放的是进程的起始物理地址，界地址寄存器存放的是进程的最大逻辑地址。

### **知识回顾**
- 内存空间的分配与回收
- 内存空间的扩充
- 地址转换
- 内存保护
    - 保证各个进程在自己的内存空间内访问，不会越界访问
    - 两种方法
        - 上、下限寄存器
        - 重定位寄存器，界地址寄存器

## 3.1.3 覆盖与交换
### **知识总览**
### **知识回顾**

## 3.1.4 连续分配管理方式
### **知识总览**
### **知识回顾**

## 3.1.5 动态分区分配算法
### **知识总览**
### **知识回顾**

## 3.1.6 基本分页存储管理的基本概念
### **知识总览**
### **知识回顾**

## 3.1.7 基本地址变换机构
### **知识总览**
### **知识回顾**

## 3.1.8 具有快表的地址变换机构
### **知识总览**
### **知识回顾**

## 3.1.9 两级页表
### **知识总览**
### **知识回顾**

## 3.1.10 基本分段存储管理方式
### **知识总览**
### **知识回顾**

## 3.1.11 段页式管理方式
### **知识总览**
### **知识回顾**